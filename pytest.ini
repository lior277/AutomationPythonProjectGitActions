[pytest]
#######################
# Test Execution Options
#######################
addopts =
    -v                              # Verbose output
    --html=/app/test-results/report.html  # Generate HTML report
    --self-contained-html           # Include assets in HTML report
    --capture=tee-sys              # Capture both stdout/stderr
    --tb=short                     # Short traceback format
    --strict-markers              # Ensure all markers are registered

#######################
# Test Discovery
#######################
testpaths = tests/ui               # Root directory for test discovery
python_files = test_*.py           # Files that are considered tests
python_classes = Test*             # Classes that are considered tests
python_functions = test_*          # Functions that are considered tests

#######################
# Logging Configuration
#######################
# Console logging
log_cli = true                     # Enable live logging
log_cli_level = INFO               # Console log level
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_cli_date_format = %Y-%m-%d %H:%M:%S

# File logging
log_file = /app/test-results/logs/pytest.log
log_file_level = DEBUG             # File log level (more detailed than console)
log_file_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_file_date_format = %Y-%m-%d %H:%M:%S

#######################
# Test Categories
#######################
markers =
    regression: Run the regression tests.
    sanity: Run the sanity tests.
    asyncio: Mark test as asyncio-based.
    slow: Mark tests that typically take longer than 30 seconds.
    flaky: Mark tests that are known to be unstable.

#######################
# Async Testing
#######################
asyncio_mode = auto                # Automatically handle async tests

#######################
# Warning Controls
#######################
filterwarnings =
    ignore::DeprecationWarning     # Ignore deprecation warnings
    ignore::UserWarning           # Ignore user warnings
    ignore::RuntimeWarning        # Ignore runtime warnings

#######################
# Timeout Settings
#######################
timeout = 300                      # Global timeout in seconds
timeout_method = thread            # Use thread-based timeout

#######################
# Flaky Test Handling
#######################
retries = 2                        # Number of times to retry failed tests
retry_delay = 1                    # Delay between retries in seconds

#######################
# Additional Settings
#######################
console_output_style = count       # Show progress as test count
max_fail = 5                       # Stop after 5 failures